<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bold Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- OpenCV -->
<script src="https://docs.opencv.org/4.9.0/opencv.js"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#111;
    color:#fff;
    margin:0;
    text-align:center;
}
header{
    background:#ff6b00;
    padding:15px;
    font-size:22px;
    font-weight:bold;
}
button{
    padding:10px 15px;
    margin:5px;
    border:none;
    background:#ff6b00;
    color:#fff;
    font-size:16px;
    border-radius:5px;
    cursor:pointer;
}
button:hover{background:#e65c00;}
canvas, video{
    max-width:95%;
    border:2px solid #444;
    margin-top:10px;
}
select{
    padding:8px;
    margin:10px;
    font-size:15px;
}
.hidden{display:none;}
</style>
</head>

<body>
<header>ðŸ“„ Bold Scanner</header>

<button onclick="startCamera()">ðŸ“· Capture</button>
<input type="file" accept="image/*" onchange="loadImage(event)">
<br>

<video id="video" class="hidden" autoplay></video><br>
<button onclick="takePhoto()">ðŸ“¸ Take Photo</button>

<canvas id="canvas"></canvas>

<br>
<select onchange="applyFilter(this.value)">
    <option value="original">Original</option>
    <option value="gray">Grayscale</option>
    <option value="bw">Black & White</option>
    <option value="enhance">Enhanced</option>
</select>

<br>
<button onclick="scanDocument()">âœ‚ Auto Scan</button>
<button onclick="downloadPDF()">â¬‡ Download PDF</button>

<script>
let video = document.getElementById("video");
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
let originalImage = null;

function startCamera(){
    navigator.mediaDevices.getUserMedia({video:true})
    .then(stream=>{
        video.srcObject = stream;
        video.classList.remove("hidden");
    });
}

function takePhoto(){
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video,0,0);
    originalImage = ctx.getImageData(0,0,canvas.width,canvas.height);
}

function loadImage(e){
    let img = new Image();
    img.onload = ()=>{
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img,0,0);
        originalImage = ctx.getImageData(0,0,canvas.width,canvas.height);
    }
    img.src = URL.createObjectURL(e.target.files[0]);
}

function applyFilter(type){
    if(!originalImage) return;
    let img = new ImageData(
        new Uint8ClampedArray(originalImage.data),
        originalImage.width,
        originalImage.height
    );

    for(let i=0;i<img.data.length;i+=4){
        let r=img.data[i], g=img.data[i+1], b=img.data[i+2];
        let gray = 0.3*r + 0.59*g + 0.11*b;

        if(type==="gray"){
            img.data[i]=img.data[i+1]=img.data[i+2]=gray;
        }
        else if(type==="bw"){
            let v = gray>140?255:0;
            img.data[i]=img.data[i+1]=img.data[i+2]=v;
        }
        else if(type==="enhance"){
            let v = Math.min(255, gray*1.4);
            img.data[i]=img.data[i+1]=img.data[i+2]=v;
        }
    }
    ctx.putImageData(img,0,0);
}

function scanDocument(){
    let src = cv.imread(canvas);
    let gray = new cv.Mat();
    cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);
    cv.GaussianBlur(gray, gray, new cv.Size(5,5),0);
    cv.Canny(gray, gray, 75, 200);

    let contours = new cv.MatVector();
    let hierarchy = new cv.Mat();
    cv.findContours(gray, contours, hierarchy, cv.RETR_LIST, cv.CHAIN_APPROX_SIMPLE);

    let maxArea = 0, pageContour = null;
    for(let i=0;i<contours.size();i++){
        let cnt = contours.get(i);
        let peri = cv.arcLength(cnt,true);
        let approx = new cv.Mat();
        cv.approxPolyDP(cnt, approx, 0.02*peri, true);
        let area = cv.contourArea(cnt);
        if(approx.rows===4 && area>maxArea){
            pageContour = approx;
            maxArea = area;
        }
    }

    if(pageContour){
        let rect = cv.boundingRect(pageContour);
        let cropped = src.roi(rect);
        cv.imshow(canvas, cropped);
    }
    src.delete(); gray.delete(); contours.delete(); hierarchy.delete();
}

function downloadPDF(){
    const { jsPDF } = window.jspdf;
    let pdf = new jsPDF("p","mm","a4");
    let img = canvas.toDataURL("image/jpeg",1.0);
    pdf.addImage(img,"JPEG",10,10,190,0);
    pdf.save("Bold_Scanner.pdf");
}
</script>
</body>
</html>
