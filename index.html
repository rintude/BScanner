<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bold Scanner</title>

<!-- Libraries -->
<script src="https://docs.opencv.org/4.9.0/opencv.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- UI Styling -->
<style>
:root{
  --primary:#ff6b00;
  --dark:#0f0f0f;
  --card:#1c1c1c;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:Inter,system-ui;
  background:var(--dark);
  color:#fff;
}
header{
  padding:14px;
  text-align:center;
  font-size:22px;
  font-weight:700;
  background:linear-gradient(90deg,var(--primary),#ff9a3c);
}
.container{
  max-width:520px;
  margin:auto;
  padding:12px;
}
.card{
  background:var(--card);
  border-radius:16px;
  padding:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.5);
}
.controls{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:10px;
}
button,select{
  flex:1;
  padding:12px;
  border:none;
  border-radius:12px;
  font-size:15px;
}
button{
  background:var(--primary);
  color:#fff;
  font-weight:600;
}
button.secondary{background:#333;}
select{background:#2a2a2a;color:#fff;}
canvas,video{
  width:100%;
  border-radius:12px;
  margin-top:10px;
}
.hidden{display:none;}
.footer{
  text-align:center;
  opacity:.6;
  font-size:12px;
  margin-top:10px;
}
</style>
</head>

<body>
<header>üìÑ Bold Scanner</header>
<div class="container">
  <div class="card">
    <div class="controls">
      <button onclick="openCamera()">üì∑ Camera</button>
      <label class="secondary" style="flex:1">
        <input type="file" accept="image/*" hidden onchange="loadImage(event)">üìÅ Upload
      </label>
    </div>

    <video id="video" class="hidden" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <div class="controls">
      <button onclick="capture()">üì∏ Capture</button>
      <button onclick="autoScan()">‚úÇ Auto Scan</button>
    </div>

    <select onchange="applyFilter(this.value)">
      <option value="original">Original</option>
      <option value="gray">Grayscale</option>
      <option value="bw">Black & White</option>
      <option value="enhance">Enhanced</option>
    </select>

    <div class="controls">
      <button onclick="exportPDF()">‚¨á PDF</button>
      <button class="secondary" onclick="resetAll()">‚ôª Reset</button>
    </div>
  </div>

  <div class="footer">Bold Scanner ‚Ä¢ Mobile‚Äëfirst ‚Ä¢ Adobe‚ÄëScan‚Äëlike</div>
</div>

<script>
let video=document.getElementById('video');
let canvas=document.getElementById('canvas');
let ctx=canvas.getContext('2d');
let baseImage=null;

function openCamera(){
  navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}})
  .then(s=>{video.srcObject=s;video.classList.remove('hidden');});
}

function capture(){
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  ctx.drawImage(video,0,0);
  baseImage=ctx.getImageData(0,0,canvas.width,canvas.height);
}

function loadImage(e){
  let img=new Image();
  img.onload=()=>{
    canvas.width=img.width;
    canvas.height=img.height;
    ctx.drawImage(img,0,0);
    baseImage=ctx.getImageData(0,0,canvas.width,canvas.height);
  }
  img.src=URL.createObjectURL(e.target.files[0]);
}

function applyFilter(type){
  if(!baseImage) return;
  let img=new ImageData(new Uint8ClampedArray(baseImage.data),baseImage.width,baseImage.height);
  for(let i=0;i<img.data.length;i+=4){
    let r=img.data[i],g=img.data[i+1],b=img.data[i+2];
    let gray=0.299*r+0.587*g+0.114*b;
    if(type==='gray'){r=g=b=gray;}
    if(type==='bw'){r=g=b=gray>150?255:0;}
    if(type==='enhance'){r=g=b=Math.min(255,gray*1.6);}    
    img.data[i]=r;img.data[i+1]=g;img.data[i+2]=b;
  }
  ctx.putImageData(img,0,0);
}

function autoScan(){
  let src=cv.imread(canvas);
  let gray=new cv.Mat();
  cv.cvtColor(src,gray,cv.COLOR_RGBA2GRAY);
  cv.GaussianBlur(gray,gray,new cv.Size(5,5),0);
  cv.Canny(gray,gray,50,150);

  let contours=new cv.MatVector();
  let hierarchy=new cv.Mat();
  cv.findContours(gray,contours,hierarchy,cv.RETR_EXTERNAL,cv.CHAIN_APPROX_SIMPLE);

  let maxArea=0,best=null;
  for(let i=0;i<contours.size();i++){
    let cnt=contours.get(i);
    let area=cv.contourArea(cnt);
    if(area>maxArea){maxArea=area;best=cnt;}
  }

  if(best){
    let rect=cv.boundingRect(best);
    let crop=src.roi(rect);
    cv.imshow(canvas,crop);
    crop.delete();
  }
  src.delete();gray.delete();contours.delete();hierarchy.delete();
}

function exportPDF(){
  const {jsPDF}=window.jspdf;
  let pdf=new jsPDF('p','mm','a4');
  let img=canvas.toDataURL('image/jpeg',0.95);
  let w=190;
  let h=canvas.height*(w/canvas.width);
  pdf.addImage(img,'JPEG',10,10,w,h);
  pdf.save('Bold_Scanner.pdf');
}

function resetAll(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  baseImage=null;
}
</script>
</body>
</html>
